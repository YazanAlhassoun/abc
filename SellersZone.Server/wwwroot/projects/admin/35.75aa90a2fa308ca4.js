"use strict";(self.webpackChunkFastkart_Admin_SSR=self.webpackChunkFastkart_Admin_SSR||[]).push([[35],{6035:(G,T,e)=>{e.r(T),e.d(T,{WalletModule:()=>Q});var c=e(177),l=e(3487),p=e(1583),u=e(1635),o=e(9417),m=e(9203),h=e(7159),C=e(1981);let v=(()=>{class s{static{this.type="[Wallet] Transaction Get"}constructor(a){this.payload=a}}return s})(),f=(()=>{class s{static{this.type="[Wallet] Credit"}constructor(a){this.payload=a}}return s})(),b=(()=>{class s{static{this.type="[Wallet] Debit"}constructor(a){this.payload=a}}return s})();var D=e(8141),t=e(4438),F=e(5482),W=e(7871),j=e(1626);let $=(()=>{class s{constructor(a){this.http=a}getUserTransaction(a){return this.http.get(`${W.c.URL}/wallet.json`,{params:a})}static{this.\u0275fac=function(n){return new(n||s)(t.KVO(j.Qq))}}static{this.\u0275prov=t.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})(),g=class I{constructor(i,a){this.notificationService=i,this.walletService=a}static wallet(i){return i.wallet}getUserTransations(i,{payload:a}){return this.walletService.getUserTransaction(a).pipe((0,D.M)({next:n=>{i.patchState({wallet:{consumer_id:n?.consumer_id,balance:n?.balance,transactions:{data:n?.transactions?.data,total:n?.transactions?.total?n?.transactions?.total:n?.transactions?.data?.length}}})},error:n=>{throw i.patchState({wallet:{consumer_id:null,balance:0,transactions:{data:[],total:0}}}),new Error(n?.error?.message)}}))}credit(i,a){}debit(i,a){}static{this.\u0275fac=function(a){return new(a||I)(t.KVO(F.J),t.KVO($))}}static{this.\u0275prov=t.jDH({token:I,factory:I.\u0275fac})}};(0,u.Cg)([(0,l.rc)(v)],g.prototype,"getUserTransations",null),(0,u.Cg)([(0,l.rc)(f)],g.prototype,"credit",null),(0,u.Cg)([(0,l.rc)(b)],g.prototype,"debit",null),(0,u.Cg)([(0,l.MD)()],g,"wallet",null),g=(0,u.Cg)([(0,l.Uw)({name:"wallet",defaults:{wallet:{consumer_id:null,balance:0,transactions:{data:[],total:0}}}})],g);var E=e(9517),w=e(67),S=e(628),U=e(1005),B=e(2541),O=e(8595),P=e(4484),A=e(3955),V=e(3088);const x=["confirmationModal"],K=()=>[];function N(s,i){if(1&s){const a=t.RV6();t.j41(0,"app-button",18),t.bIt("click",function(){t.eBV(a);const r=t.XpG();return t.Njj(r.form.valid&&r.ConfirmationModal.openModal("credit"))}),t.EFF(1),t.nI1(2,"translate"),t.k0s()}if(2&s){const a=t.XpG();t.HbH("btn btn-animation"),t.Y8G("disabled",!a.form.valid)("spinner",!1),t.R7$(),t.SpI(" ",t.bMT(2,5,"add")," ")}}function Y(s,i){if(1&s){const a=t.RV6();t.j41(0,"app-button",19),t.bIt("click",function(){t.eBV(a);const r=t.XpG(),M=t.sdS(24);return t.Njj(+r.balance<+M.value||!!M.value&&r.ConfirmationModal.openModal("debit"))}),t.EFF(1),t.nI1(2,"translate"),t.k0s()}if(2&s){const a=t.XpG(),n=t.sdS(24);t.HbH("btn btn-outline"),t.Y8G("spinner",!1)("disabled",+a.balance<+n.value||!n.value),t.R7$(),t.SpI(" ",t.bMT(2,5,"withdraw")," ")}}class y{constructor(i,a,n,r){this.document=i,this.renderer=a,this.store=n,this.formBuilder=r,this.balance=0,this.tableConfig={columns:[{title:"No.",dataField:"no",type:"no"},{title:"amount",dataField:"amount",type:"price"},{title:"type",dataField:"type_status"},{title:"remark",dataField:"detail"},{title:"created_at",dataField:"created_at",type:"date"}],data:[],total:0},this.store.dispatch(new C.TB({role:"consumer",status:1})),this.form=this.formBuilder.group({consumer_id:new o.MJ("",[o.k0.required]),balance:new o.MJ("",[o.k0.required])}),this.form.controls.consumer_id.valueChanges.subscribe(M=>{M?(this.paginateInitialData.consumer_id=M,this.store.dispatch(new v(this.paginateInitialData)),this.wallet$.subscribe(d=>{let k=d?.transactions?.data?.filter(R=>(R.type_status=R.type?`<div class="status-${R.type}"><span>${R.type.replace(/_/g," ")}</span></div>`:"-",R));this.balance=d?d?.balance:0,this.tableConfig.data=d?k:[],this.tableConfig.total=d?d?.transactions?.total:0}),this.renderer.addClass(this.document.body,"loader-none")):(this.balance=0,this.tableConfig.data=[],this.tableConfig.total=0,this.form.controls.balance.reset())})}onTableChange(i){this.paginateInitialData=i;let a=this.form.controls.consumer_id?.value;this.paginateInitialData.consumer_id=a,a&&this.store.dispatch(new v(i))}submit(i){this.form.markAllAsTouched();let a=new f(this.form.value);"debit"==i&&(a=new b(this.form.value)),this.form.valid&&this.store.dispatch(a).subscribe({complete:()=>{this.form.controls.balance.reset()}})}ngOnDestroy(){this.renderer.removeClass(this.document.body,"loader-none")}static{this.\u0275fac=function(a){return new(a||y)(t.rXU(c.qQ),t.rXU(t.sFG),t.rXU(l.il),t.rXU(o.ok))}}static{this.\u0275cmp=t.VBU({type:y,selectors:[["app-wallet"]],viewQuery:function(a,n){if(1&a&&t.GBs(x,5),2&a){let r;t.mGM(r=t.lsd())&&(n.ConfirmationModal=r.first)}},decls:33,vars:33,consts:[["bal",""],["confirmationModal",""],[1,"row","g-0"],[1,"col-xxl-4","col-xl-5"],[3,"formGroup"],[3,"gridClass","title"],["formControlName","consumer_id",1,"custom-select",3,"data","placeholder","noResultMessage"],[1,"col-xxl-8","col-xl-7"],[1,"wallet-sec","theme-form"],[1,"wallet-amount"],[1,"wallet-icon"],[1,"ri-wallet-line"],["type","number","formControlName","balance","numbersOnly","",1,"form-control",3,"placeholder"],[1,"btn-sec"],[3,"class","disabled","spinner","click",4,"hasPermission"],[3,"class","spinner","disabled","click",4,"hasPermission"],[3,"tableChanged","dateRange","tableConfig"],[3,"confirmed"],[3,"click","disabled","spinner"],[3,"click","spinner","disabled"]],template:function(a,n){if(1&a){const r=t.RV6();t.j41(0,"div",2)(1,"div",3)(2,"form",4)(3,"app-page-wrapper",5),t.nrm(4,"select2",6),t.nI1(5,"translate"),t.nI1(6,"async"),t.nI1(7,"async"),t.nI1(8,"translate"),t.k0s()()(),t.j41(9,"div",7)(10,"form",4)(11,"app-page-wrapper",5)(12,"div",8)(13,"div",9)(14,"div",10),t.nrm(15,"i",11),t.k0s(),t.j41(16,"div")(17,"h2"),t.EFF(18),t.nI1(19,"currencySymbol"),t.k0s(),t.j41(20,"h5"),t.EFF(21),t.nI1(22,"translate"),t.k0s()()(),t.nrm(23,"input",12,0),t.nI1(25,"translate"),t.j41(26,"div",13),t.DNE(27,N,3,7,"app-button",14)(28,Y,3,7,"app-button",15),t.k0s()()()()()(),t.j41(29,"app-page-wrapper",5)(30,"app-table",16),t.bIt("tableChanged",function(d){return t.eBV(r),t.Njj(n.onTableChange(d))}),t.k0s()(),t.j41(31,"app-confirmation-modal",17,1),t.bIt("confirmed",function(d){return t.eBV(r),t.Njj(n.submit(null==d?null:d.actionToPerform))}),t.k0s()}if(2&a){let r;t.R7$(2),t.Y8G("formGroup",n.form),t.R7$(),t.Y8G("gridClass","col-sm-12")("title","select_consumer"),t.R7$(),t.FS9("noResultMessage",t.bMT(5,18,"no_data_found")),t.Y8G("data",null!=(r=t.bMT(6,20,n.users$))&&r.length?t.bMT(7,22,n.users$):t.lJ4(32,K))("placeholder",t.bMT(8,24,"select_consumer")),t.R7$(6),t.Y8G("formGroup",n.form),t.R7$(),t.Y8G("gridClass","col-sm-12")("title","wallet"),t.R7$(7),t.JRh(t.bMT(19,26,n.balance)),t.R7$(3),t.JRh(t.bMT(22,28,"wallet_balance")),t.R7$(2),t.FS9("placeholder",t.bMT(25,30,"add_withdraw_amount")),t.R7$(4),t.Y8G("hasPermission","wallet.credit"),t.R7$(),t.Y8G("hasPermission","wallet.debit"),t.R7$(),t.Y8G("gridClass","col-sm-12")("title","transactions"),t.R7$(),t.Y8G("dateRange",!0)("tableConfig",n.tableConfig)}},dependencies:[o.qT,o.me,o.Q0,o.BC,o.cb,o.j4,o.JD,E.R6,w.O,S.k,U.Q,B.M,O.v,P.p,c.Jj,A.D9,V.G]})}}(0,u.Cg)([(0,l.l6)(h.b.users)],y.prototype,"users$",void 0),(0,u.Cg)([(0,l.l6)(g.wallet)],y.prototype,"wallet$",void 0),(0,u.Cg)([(0,l.l6)(m.E.setting)],y.prototype,"setting$",void 0);var H=e(8745);const X=[{path:"",component:y,canActivate:[H.L],data:{permission:"wallet.index"}}];let J=(()=>{class s{static{this.\u0275fac=function(n){return new(n||s)}}static{this.\u0275mod=t.$C({type:s})}static{this.\u0275inj=t.G2t({imports:[p.iI.forChild(X),p.iI]})}}return s})();var L=e(1592);let Q=(()=>{class s{static{this.\u0275fac=function(n){return new(n||s)}}static{this.\u0275mod=t.$C({type:s})}static{this.\u0275inj=t.G2t({imports:[c.MD,J,L.G,l.rK.forFeature([h.b,g,m.E])]})}}return s})()},8745:(G,T,e)=>{e.d(T,{L:()=>u});var c=e(4438),l=e(3487),p=e(1583);let u=(()=>{class o{constructor(h,C){this.store=h,this.router=C}canActivate(h,C){const v=this.store.selectSnapshot(b=>b.account).permissions?.map(b=>b?.name),f=h.data?.permission;return!!(!f||!Array.isArray(f)&&v?.includes(f)||Array.isArray(f)&&f?.length&&f.every(b=>v?.includes(b)))||(this.router.navigate(["/error/403"]),!1)}static{this.\u0275fac=function(C){return new(C||o)(c.KVO(l.il),c.KVO(p.Ix))}}static{this.\u0275prov=c.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})()},8595:(G,T,e)=>{e.d(T,{v:()=>l});var c=e(4438);let l=(()=>{class p{constructor(o){this._el=o}onInputChange(o){const m=this._el.nativeElement.value;this._el.nativeElement.value=m.replace(/[^0-9]*/g,""),m!==this._el.nativeElement.value&&o.stopPropagation()}static{this.\u0275fac=function(m){return new(m||p)(c.rXU(c.aKT))}}static{this.\u0275dir=c.FsC({type:p,selectors:[["input","numbersOnly",""]],hostBindings:function(m,h){1&m&&c.bIt("input",function(v){return h.onInputChange(v)})}})}}return p})()}}]);