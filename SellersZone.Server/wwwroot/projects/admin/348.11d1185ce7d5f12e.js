"use strict";(self.webpackChunkFastkart_Admin_SSR=self.webpackChunkFastkart_Admin_SSR||[]).push([[348],{2348:(R,y,e)=>{e.r(y),e.d(y,{PointModule:()=>w});var c=e(177),l=e(3487),p=e(1583),u=e(1635),i=e(9417),m=e(7159),b=e(8141);let h=(()=>{class o{static{this.type="[Point] Transaction Get"}constructor(n){this.payload=n}}return o})(),g=(()=>{class o{static{this.type="[Point] Credit"}constructor(n){this.payload=n}}return o})(),f=(()=>{class o{static{this.type="[Point] Debit"}constructor(n){this.payload=n}}return o})();var t=e(4438),I=e(5482),D=e(7871),G=e(1626);let F=(()=>{class o{constructor(n){this.http=n}getUserTransaction(n){return this.http.get(`${D.c.URL}/point.json`,{params:n})}static{this.\u0275fac=function(a){return new(a||o)(t.KVO(G.Qq))}}static{this.\u0275prov=t.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})(),v=class T{constructor(s,n){this.notificationService=s,this.pointService=n}static point(s){return s.point}getUserTransaction(s,{payload:n}){return this.pointService.getUserTransaction(n).pipe((0,b.M)({next:a=>{s.patchState({point:{consumer_id:a?.consumer_id,balance:a?.balance,transactions:{data:a?.transactions?.data,total:a?.transactions?.total?a?.transactions?.total:a?.transactions?.data?.length}}})},error:a=>{throw s.patchState({point:{consumer_id:null,balance:0,transactions:{data:[],total:0}}}),new Error(a?.error?.message)}}))}credit(s,n){}debit(s,n){}static{this.\u0275fac=function(n){return new(n||T)(t.KVO(I.J),t.KVO(F))}}static{this.\u0275prov=t.jDH({token:T,factory:T.\u0275fac})}};(0,u.Cg)([(0,l.rc)(h)],v.prototype,"getUserTransaction",null),(0,u.Cg)([(0,l.rc)(g)],v.prototype,"credit",null),(0,u.Cg)([(0,l.rc)(f)],v.prototype,"debit",null),(0,u.Cg)([(0,l.MD)()],v,"point",null),v=(0,u.Cg)([(0,l.Uw)({name:"point",defaults:{point:{consumer_id:null,balance:0,transactions:{data:[],total:0}}}})],v);var j=e(1981),$=e(9517),E=e(67),S=e(628),U=e(1005),B=e(2541),O=e(8595),A=e(4484),V=e(3955);const x=["confirmationModal"],K=()=>[];function N(o,s){if(1&o){const n=t.RV6();t.j41(0,"app-button",18),t.bIt("click",function(){t.eBV(n);const r=t.XpG();return t.Njj(r.form.valid&&r.ConfirmationModal.openModal("credit"))}),t.EFF(1),t.nI1(2,"translate"),t.k0s()}if(2&o){const n=t.XpG();t.HbH("btn btn-animation"),t.Y8G("disabled",!n.form.valid)("spinner",!1),t.R7$(),t.SpI(" ",t.bMT(2,5,"add")," ")}}function Y(o,s){if(1&o){const n=t.RV6();t.j41(0,"app-button",19),t.bIt("click",function(){t.eBV(n);const r=t.XpG(),C=t.sdS(22);return t.Njj((+r.balance<+C.value||!!C.value)&&r.ConfirmationModal.openModal("debit"))}),t.EFF(1),t.nI1(2,"translate"),t.k0s()}if(2&o){const n=t.XpG(),a=t.sdS(22);t.HbH("btn btn-outline"),t.Y8G("spinner",!1)("disabled",+n.balance<+a.value||!a.value),t.R7$(),t.SpI(" ",t.bMT(2,5,"withdraw")," ")}}class P{constructor(s,n,a,r){this.document=s,this.renderer=n,this.store=a,this.formBuilder=r,this.balance=0,this.tableConfig={columns:[{title:"No.",dataField:"no",type:"no"},{title:"points",dataField:"amount"},{title:"type",dataField:"type_status"},{title:"remark",dataField:"detail"},{title:"created_at",dataField:"created_at",type:"date"}],data:[],total:0},this.store.dispatch(new j.TB({role:"consumer",status:1})),this.form=this.formBuilder.group({consumer_id:new i.MJ("",[i.k0.required]),balance:new i.MJ("",[i.k0.required])}),this.form.controls.consumer_id.valueChanges.subscribe(C=>{C?(this.paginateInitialData.consumer_id=C,this.store.dispatch(new h(this.paginateInitialData)),this.point$.subscribe(d=>{let L=d?.transactions?.data?.filter(M=>(M.type_status=M.type?`<div class="status-${M.type}"><span>${M.type.replace(/_/g," ")}</span></div>`:"-",M));this.balance=d?d?.balance:0,this.tableConfig.data=d?L:[],this.tableConfig.total=d?d?.transactions?.total:0}),this.renderer.addClass(this.document.body,"loader-none")):(this.balance=0,this.tableConfig.data=[],this.tableConfig.total=0,this.form.controls.balance.reset())})}onTableChange(s){this.paginateInitialData=s;let n=this.form.controls.consumer_id?.value;this.paginateInitialData.consumer_id=n,n&&this.store.dispatch(new h(s))}submit(s){this.form.markAllAsTouched();let n=new g(this.form.value);"debit"==s&&(n=new f(this.form.value)),this.form.valid&&this.store.dispatch(n).subscribe({complete:()=>{this.form.controls.balance.reset()}})}ngOnDestroy(){this.renderer.removeClass(this.document.body,"loader-none")}static{this.\u0275fac=function(n){return new(n||P)(t.rXU(c.qQ),t.rXU(t.sFG),t.rXU(l.il),t.rXU(i.ok))}}static{this.\u0275cmp=t.VBU({type:P,selectors:[["app-point"]],viewQuery:function(n,a){if(1&n&&t.GBs(x,5),2&n){let r;t.mGM(r=t.lsd())&&(a.ConfirmationModal=r.first)}},decls:30,vars:25,consts:[["bal",""],["confirmationModal",""],[1,"row","g-0"],[1,"col-xxl-4","col-xl-5"],[3,"formGroup"],[3,"gridClass","title"],["formControlName","consumer_id",1,"custom-select",3,"data","placeholder"],[1,"col-xxl-8","col-xl-7"],[1,"wallet-sec","theme-form"],[1,"wallet-amount"],[1,"wallet-icon"],[1,"ri-copper-diamond-line"],["type","number","formControlName","balance","placeholder","add / withdraw amount","numbersOnly","",1,"form-control"],[1,"btn-sec"],[3,"class","disabled","spinner","click",4,"hasPermission"],[3,"class","spinner","disabled","click",4,"hasPermission"],[3,"tableChanged","dateRange","tableConfig"],[3,"confirmed"],[3,"click","disabled","spinner"],[3,"click","spinner","disabled"]],template:function(n,a){if(1&n){const r=t.RV6();t.j41(0,"div",2)(1,"div",3)(2,"form",4)(3,"app-page-wrapper",5),t.nrm(4,"select2",6),t.nI1(5,"async"),t.nI1(6,"async"),t.nI1(7,"translate"),t.k0s()()(),t.j41(8,"div",7)(9,"form",4)(10,"app-page-wrapper",5)(11,"div",8)(12,"div",9)(13,"div",10),t.nrm(14,"i",11),t.k0s(),t.j41(15,"div")(16,"h2"),t.EFF(17),t.k0s(),t.j41(18,"h5"),t.EFF(19),t.nI1(20,"translate"),t.k0s()()(),t.nrm(21,"input",12,0),t.j41(23,"div",13),t.DNE(24,N,3,7,"app-button",14)(25,Y,3,7,"app-button",15),t.k0s()()()()()(),t.j41(26,"app-page-wrapper",5)(27,"app-table",16),t.bIt("tableChanged",function(d){return t.eBV(r),t.Njj(a.onTableChange(d))}),t.k0s()(),t.j41(28,"app-confirmation-modal",17,1),t.bIt("confirmed",function(d){return t.eBV(r),t.Njj(a.submit(null==d?null:d.actionToPerform))}),t.k0s()}if(2&n){let r;t.R7$(2),t.Y8G("formGroup",a.form),t.R7$(),t.Y8G("gridClass","col-sm-12")("title","select_consumer"),t.R7$(),t.Y8G("data",null!=(r=t.bMT(5,16,a.users$))&&r.length?t.bMT(6,18,a.users$):t.lJ4(24,K))("placeholder",t.bMT(7,20,"select_consumer")),t.R7$(5),t.Y8G("formGroup",a.form),t.R7$(),t.Y8G("gridClass","col-sm-12")("title","point"),t.R7$(7),t.JRh(null==a.balance?null:a.balance.toFixed(2)),t.R7$(2),t.JRh(t.bMT(20,22,"point_balance")),t.R7$(5),t.Y8G("hasPermission","point.credit"),t.R7$(),t.Y8G("hasPermission","point.debit"),t.R7$(),t.Y8G("gridClass","col-sm-12")("title","transactions"),t.R7$(),t.Y8G("dateRange",!0)("tableConfig",a.tableConfig)}},dependencies:[i.qT,i.me,i.Q0,i.BC,i.cb,i.j4,i.JD,$.R6,E.O,S.k,U.Q,B.M,O.v,A.p,c.Jj,V.D9]})}}(0,u.Cg)([(0,l.l6)(m.b.users)],P.prototype,"users$",void 0),(0,u.Cg)([(0,l.l6)(v.point)],P.prototype,"point$",void 0);var H=e(8745);const X=[{path:"",component:P,canActivate:[H.L],data:{permission:"point.index"}}];let J=(()=>{class o{static{this.\u0275fac=function(a){return new(a||o)}}static{this.\u0275mod=t.$C({type:o})}static{this.\u0275inj=t.G2t({imports:[p.iI.forChild(X),p.iI]})}}return o})();var k=e(1592);let w=(()=>{class o{static{this.\u0275fac=function(a){return new(a||o)}}static{this.\u0275mod=t.$C({type:o})}static{this.\u0275inj=t.G2t({imports:[c.MD,J,k.G,l.rK.forFeature([m.b,v])]})}}return o})()},8745:(R,y,e)=>{e.d(y,{L:()=>u});var c=e(4438),l=e(3487),p=e(1583);let u=(()=>{class i{constructor(b,h){this.store=b,this.router=h}canActivate(b,h){const g=this.store.selectSnapshot(t=>t.account).permissions?.map(t=>t?.name),f=b.data?.permission;return!!(!f||!Array.isArray(f)&&g?.includes(f)||Array.isArray(f)&&f?.length&&f.every(t=>g?.includes(t)))||(this.router.navigate(["/error/403"]),!1)}static{this.\u0275fac=function(h){return new(h||i)(c.KVO(l.il),c.KVO(p.Ix))}}static{this.\u0275prov=c.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})()},8595:(R,y,e)=>{e.d(y,{v:()=>l});var c=e(4438);let l=(()=>{class p{constructor(i){this._el=i}onInputChange(i){const m=this._el.nativeElement.value;this._el.nativeElement.value=m.replace(/[^0-9]*/g,""),m!==this._el.nativeElement.value&&i.stopPropagation()}static{this.\u0275fac=function(m){return new(m||p)(c.rXU(c.aKT))}}static{this.\u0275dir=c.FsC({type:p,selectors:[["input","numbersOnly",""]],hostBindings:function(m,b){1&m&&c.bIt("input",function(g){return b.onInputChange(g)})}})}}return p})()}}]);